#!/usr/bin/env python3

from copy import deepcopy
import math, copy
import numpy as np
from scipy.spatial.transform import Rotation as R
import gym
from gym import spaces
from gym.utils import seeding
from robo_gym.utils import utils, ur_utils
from robo_gym.utils.exceptions import InvalidStateError, RobotServerError
import robo_gym_server_modules.robot_server.client as rs_client
from robo_gym.envs.simulation_wrapper import Simulation
from robo_gym_server_modules.robot_server.grpc_msgs.python import robot_server_pb2

from robo_gym.envs.ur5.ur5_avoidance import MovingBoxTargetUR5

DEBUG = True

TRAJECTORY =  [[-1.2340825239764612, -1.854387108479635, -1.7842381636248987, -1.0661042372332972, 1.5948741436004639, -0.06893474260439092], [-1.2340944449054163, -1.8542311827289026, -1.78168231645693, -1.0686801115619105, 1.594934105873108, -0.06892282167543584], [-1.2341182867633265, -1.853907887135641, -1.7769082228290003, -1.0740707556353968, 1.5951257944107056, -0.06892282167543584], [-1.2340944449054163, -1.853429142628805, -1.7712095419513147, -1.0802996794330042, 1.5950419902801514, -0.06891042390932256], [-1.2340825239764612, -1.8527820746051233, -1.7639029661761683, -1.0881217161761683, 1.595005989074707, -0.06907779375185186], [-1.2341063658343714, -1.8520272413836878, -1.755061451588766, -1.0976937452899378, 1.5950778722763062, -0.0691140333758753], [-1.2340343634234827, -1.8510091940509241, -1.74302846590151, -1.1108344236956995, 1.594934105873108, -0.06926995912660772], [-1.2340224424945276, -1.8500273863421839, -1.7309835592852991, -1.123699967061178, 1.595065951347351, -0.06940156618227178], [-1.2339628378497522, -1.8489130179034632, -1.7174270788775843, -1.1383631865130823, 1.5949580669403076, -0.06952125230898076], [-1.2339027563678187, -1.8477633635150355, -1.702538792287008, -1.1544879118548792, 1.5950419902801514, -0.06970101991762334], [-1.2338545958148401, -1.8461578528033655, -1.6831520239459437, -1.175692383443014, 1.5948981046676636, -0.06995231309999639], [-1.2337945143329065, -1.8447330633746546, -1.6648810545550745, -1.1953395048724573, 1.5950539112091064, -0.07013208070863897], [-1.2336867491351526, -1.843163792287008, -1.6452544371234339, -1.2165206114398401, 1.595065951347351, -0.0703356901751917], [-1.2335670630084437, -1.8411992231952112, -1.6202777067767542, -1.2433818022357386, 1.5951497554779053, -0.07061130205263311], [-1.2335189024554651, -1.8393905798541468, -1.5973408857928675, -1.267966095601217, 1.5951378345489502, -0.070838753377096], [-1.2334349791156214, -1.8374503294574183, -1.5740678946124476, -1.293234650288717, 1.5950419902801514, -0.0711143652545374], [-1.2333267370807093, -1.8356531302081507, -1.5507710615741175, -1.3181803862201136, 1.5951497554779053, -0.07137757936586553], [-1.2331708113299769, -1.8334139029132288, -1.5236237684832972, -1.3475716749774378, 1.5950778722763062, -0.07164079347719365], [-1.2331350485431116, -1.831700627003805, -1.50029164949526, -1.3725665251361292, 1.595233678817749, -0.07191640535463506], [-1.2331112066852015, -1.829843823109762, -1.47705585161318, -1.3978255430804651, 1.5950539112091064, -0.0722277800189417], [-1.2330153624164026, -1.827939812337057, -1.45384389558901, -1.4229767958270472, 1.59516179561615, -0.0723956266986292], [-1.2328832785235804, -1.8257477919207972, -1.4266379515277308, -1.452287499104635, 1.59516179561615, -0.07270652452577764], [-1.2327869574176233, -1.8239153067218226, -1.4032710234271448, -1.4774282614337366, 1.595221757888794, -0.07296973863710576], [-1.232727352772848, -1.822082821522848, -1.380120102559225, -1.502474610005514, 1.5953176021575928, -0.07324535051454717], [-1.2326434294330042, -1.8198426405536097, -1.3529513517962855, -1.5318587462054651, 1.5952576398849487, -0.07355672517885381], [-1.232511345540182, -1.8180096785174769, -1.3297413031207483, -1.557145897542135, 1.5952816009521484, -0.07386809984316045], [-1.2324517408954065, -1.8162134329425257, -1.3063753286944788, -1.5823858420001429, 1.59516179561615, -0.07416755357851201], [-1.232391659413473, -1.8143327871905726, -1.2831175963031214, -1.6075776259051722, 1.595233678817749, -0.07434684434999639], [-1.232307259236471, -1.812153164540426, -1.2559989134417933, -1.6369174162494105, 1.5952816009521484, -0.07464677492250615], [-1.2322352568255823, -1.810272518788473, -1.2332938353167933, -1.6613314787494105, 1.5954134464263916, -0.07484990755190069], [-1.2321274916278284, -1.808631722127096, -1.2120164076434534, -1.6841524283038538, 1.595353603363037, -0.07510120073427373], [-1.2321394125567835, -1.8070867697345179, -1.1924908796893519, -1.705428425465719, 1.5952816009521484, -0.07529288927187139], [-1.2320197264300745, -1.8053978125201624, -1.1714423338519495, -1.7282021681415003, 1.5953775644302368, -0.07558042207826787], [-1.2319358030902308, -1.804176155720846, -1.1549275557147425, -1.7459781805621546, 1.5953176021575928, -0.07574779192079717], [-1.2319119612323206, -1.8029540220843714, -1.1401155630694788, -1.7621963659869593, 1.595461368560791, -0.0759514013873499], [-1.2319000403033655, -1.8016966024981897, -1.1245124975787562, -1.7788580099688929, 1.595449447631836, -0.07613116899599248], [-1.2316840330706995, -1.8007381598102015, -1.1126397291766565, -1.7918880621539515, 1.595449447631836, -0.07615501085390264], [-1.231288258229391, -1.7998641172992151, -1.1016057173358362, -1.8037312666522425, 1.5955332517623901, -0.07598716417421514], [-1.2304728666888636, -1.7989652792560022, -1.0909207502948206, -1.8150714079486292, 1.5953295230865479, -0.07553273836244756], [-1.228973690663473, -1.7977679411517542, -1.0792878309832972, -1.8280423323260706, 1.595449447631836, -0.07425100008119756], [-1.2268150488482874, -1.7967494169818323, -1.069549862538473, -1.8386991659747522, 1.5953055620193481, -0.07228738466371709], [-1.2238405386554163, -1.7956717650042933, -1.0602310339557093, -1.8488886992083948, 1.5954015254974365, -0.06942540804018194], [-1.219954792653219, -1.7945573965655726, -1.0517647902118128, -1.8585990110980433, 1.595353603363037, -0.06542569795717412], [-1.213909927998678, -1.7932642141925257, -1.0430105368243616, -1.8687050978290003, 1.5953295230865479, -0.05949908891786748], [-1.2075417677508753, -1.7920544783221644, -1.0365703741656702, -1.876317326222555, 1.5952457189559937, -0.05321246782411748], [-1.1999505201922815, -1.7906888167010706, -1.0313542524920862, -1.8827431837665003, 1.595005989074707, -0.045692269002096], [-1.1898401419269007, -1.789203945790426, -1.0272162596331995, -1.88832933107485, 1.5949701070785522, -0.035657707844869435], [-1.179957691823141, -1.7879698912249964, -1.0252020994769495, -1.891601864491598, 1.5946943759918213, -0.02582723299135381], [-1.1691883246051233, -1.7866886297809046, -1.024494473134176, -1.893508259450094, 1.5946221351623535, -0.0150988737689417], [-1.1577113310443323, -1.7855265776263636, -1.0250580946551722, -1.894167725239889, 1.5945621728897095, -0.0036395231830042007], [-1.1438348929034632, -1.7840655485736292, -1.0264609495746058, -1.8940117994891565, 1.594250202178955, 0.010261492803692818], [-1.131362263356344, -1.7827957312213343, -1.02802020708193, -1.8938563505755823, 1.5941184759140015, 0.02281009964644909], [-1.1171391646014612, -1.7813223044024866, -1.0296152273761194, -1.8936403433429163, 1.5940704345703125, 0.036758989095687866], [-1.1015365759478968, -1.7798011938678187, -1.031569782887594, -1.8932326475726526, 1.593674659729004, 0.05254034325480461], [-1.081160847340719, -1.7776454130755823, -1.0340760389911097, -1.8927891890155237, 1.593458890914917, 0.07295472174882889], [-1.0619123617755335, -1.7756693998919886, -1.036403004323141, -1.8923218886004847, 1.5931113958358765, 0.09220775216817856], [-1.0410688559161585, -1.7735970656024378, -1.0389450232135218, -1.8917697111712855, 1.5930874347686768, 0.11307678371667862], [-1.0146496931659144, -1.7708547751056116, -1.0420869032489222, -1.8911226431476038, 1.5927155017852783, 0.1394653022289276], [-0.9903042952166956, -1.7683752218829554, -1.04504901567568, -1.8906553427325647, 1.5923559665679932, 0.16394981741905212], [-0.9651683012591761, -1.7657998243915003, -1.0481427351581019, -1.8900554815875452, 1.5921043157577515, 0.18897287547588348], [-0.9400442282306116, -1.7631648222552698, -1.0511530081378382, -1.8894804159747522, 1.5916844606399536, 0.21413899958133698], [-0.9105790297137659, -1.7601826826678675, -1.0547025839435022, -1.8887484709369105, 1.5913249254226685, 0.24347151815891266], [-0.8854196707354944, -1.757571045552389, -1.0578087011920374, -1.8881257216082972, 1.5910849571228027, 0.2687327563762665], [-0.860272232686178, -1.7550323645221155, -1.0608065764056605, -1.8874900976764124, 1.5906654596328735, 0.29386255145072937], [-0.8350537459002894, -1.752517048512594, -1.063948933278219, -1.8870347181903284, 1.590329885482788, 0.31896838545799255], [-0.805793587361471, -1.7495344320880335, -1.0675347487079065, -1.8863514105426233, 1.5899699926376343, 0.34829941391944885], [-0.7807067076312464, -1.7469356695758265, -1.0705331007586878, -1.8856805006610315, 1.5898022651672363, 0.3732966184616089], [-0.7558005491839808, -1.7443364302264612, -1.0734828154193323, -1.8851164023028772, 1.5892984867095947, 0.3985339105129242], [-0.7264578978167933, -1.7414262930499476, -1.077057186757223, -1.884409252797262, 1.5889389514923096, 0.42773309350013733], [-0.70136005083193, -1.738779369984762, -1.0800789038287562, -1.8839896360980433, 1.5884835720062256, 0.45293331146240234], [-0.6762149969684046, -1.736203972493307, -1.0830653349505823, -1.883390251790182, 1.5882915258407593, 0.47802603244781494], [-0.6510818640338343, -1.7336528936969202, -1.0860994497882288, -1.8826711813556116, 1.587740182876587, 0.5031663179397583], [-0.621800724660055, -1.7305987516986292, -1.0897210280047815, -1.8819635550128382, 1.5875240564346313, 0.5325209498405457], [-0.5967043081866663, -1.7280834356891077, -1.0927193800555628, -1.8814242521869105, 1.5870567560195923, 0.5576491951942444], [-0.5716083685504358, -1.7254608313189905, -1.0958731810199183, -1.8807528654681605, 1.5869249105453491, 0.5828614234924316], [-0.5463922659503382, -1.7229097525226038, -1.0988953749286097, -1.8802254835711878, 1.5864450931549072, 0.6079777479171753], [-0.517029110585348, -1.719903294240133, -1.1025050322162073, -1.8795302549945276, 1.5860376358032227, 0.6373798847198486], [-0.4917662779437464, -1.7173522154437464, -1.1054437796222132, -1.8789427916156214, 1.5856534242630005, 0.6626759767532349], [-0.46667176881899053, -1.714741055165426, -1.1085494200335901, -1.878354851399557, 1.5854976177215576, 0.6877443790435791], [-0.4372614065753382, -1.7117469946490687, -1.1120274702655237, -1.8775880972491663, 1.5849103927612305, 0.7170510292053223], [-0.41215593019594365, -1.709195915852682, -1.1151097456561487, -1.8769882361041468, 1.584754228591919, 0.7421197891235352], [-0.3870146910296839, -1.706620995198385, -1.118096176777975, -1.8765090147601526, 1.5843348503112793, 0.7673802971839905], [-0.36218578020204717, -1.7040699164019983, -1.1212380568133753, -1.875850025807516, 1.5839632749557495, 0.7925449013710022], [-0.33294517198671514, -1.7010157744037073, -1.1247885862933558, -1.8751419226275843, 1.5836633443832397, 0.8218519687652588], [-0.30782920518984014, -1.6984770933734339, -1.1278823057757776, -1.8747108618365687, 1.5832798480987549, 0.8470045924186707], [-0.2828577200519007, -1.6958778540240687, -1.1308448950396937, -1.8740275541888636, 1.5830761194229126, 0.8720265030860901], [-0.257514778767721, -1.6932666937457483, -1.1339028517352503, -1.8734639326678675, 1.5825244188308716, 0.8972877860069275], [-0.22827655473817998, -1.6903207937823694, -1.1373689810382288, -1.872828785573141, 1.5822967290878296, 0.9265117049217224], [-0.20311385789980108, -1.6877453962909144, -1.140475098286764, -1.8722294012652796, 1.5818289518356323, 0.951749324798584], [-0.17796451250185186, -1.6851709524737757, -1.1434853712665003, -1.87160569826235, 1.581685185432434, 0.9769510626792908], [-0.14857179323305303, -1.6822121779071253, -1.1469996611224573, -1.8708503882037562, 1.5811814069747925, 1.0062363147735596], [-0.12344724336733037, -1.6796610991107386, -1.150142017995016, -1.8701909224139612, 1.5808218717575073, 1.0313905477523804], [-0.09825116792787725, -1.6770499388324183, -1.1531642119037073, -1.8698437849627894, 1.580390453338623, 1.0563180446624756], [-0.0731270948993128, -1.6744993368731897, -1.1562226454364222, -1.869244400654928, 1.5802582502365112, 1.081497311592102], [-0.04501945177187139, -1.6715648810016077, -1.159640137349264, -1.8685973326312464, 1.5797909498214722, 1.109418272972107], [-0.022857014332906544, -1.6693008581744593, -1.162351433430807, -1.8679974714862269, 1.579431414604187, 1.131760597229004], [-0.0022414366351526382, -1.667229477559225, -1.1648576895343226, -1.8674457708941858, 1.5791313648223877, 1.1524267196655273], [0.016588039696216583, -1.6652653853045862, -1.1670883337603968, -1.8670147101031702, 1.5790235996246338, 1.1715127229690552], [0.03683164343237877, -1.663121525441305, -1.1695955435382288, -1.866558853779928, 1.5786759853363037, 1.191748023033142], [0.05240102484822273, -1.661588493977682, -1.1714542547809046, -1.8662713209735315, 1.578507900238037, 1.2072781324386597], [0.06630384922027588, -1.6601393858539026, -1.1731208006488245, -1.865875546132223, 1.578160285949707, 1.2212393283843994], [0.08092572540044785, -1.658665959035055, -1.1749323050128382, -1.8654683271991175, 1.5779685974121094, 1.2357761859893799], [0.09329419583082199, -1.6573966185199183, -1.1766951719867151, -1.8649762312518519, 1.5776087045669556, 1.2480615377426147], [0.10505110025405884, -1.656426731740133, -1.1788538138019007, -1.8637297789203089, 1.5775727033615112, 1.2598443031311035], [0.11593389511108398, -1.6555283705340784, -1.1816723982440394, -1.8617513815509241, 1.5774768590927124, 1.2707529067993164], [0.12765446305274963, -1.6548455397235315, -1.1858585516559046, -1.8580473105060022, 1.5772970914840698, 1.2825113534927368], [0.13657110929489136, -1.6546896139727991, -1.1905000845538538, -1.853731934224264, 1.5772610902786255, 1.291348934173584], [0.14424100518226624, -1.6547134558307093, -1.1958850065814417, -1.8481572310077112, 1.5770454406738281, 1.2990963459014893], [0.15079675614833832, -1.6549652258502405, -1.2022536436664026, -1.8414080778705042, 1.5769615173339844, 1.3057899475097656], [0.1569686383008957, -1.6557439009295862, -1.2106850782977503, -1.832033936177389, 1.5767817497253418, 1.312112808227539], [0.1609833538532257, -1.65676194826235, -1.2191527525531214, -1.82257587114443, 1.5767334699630737, 1.3163278102874756], [0.1639917641878128, -1.65806752840151, -1.2284839789019983, -1.812098805104391, 1.5767697095870972, 1.3195250034332275], [0.16644816100597382, -1.6599834601031702, -1.2399867216693323, -1.7987211386310022, 1.5766135454177856, 1.3221356868743896], [0.16776679456233978, -1.661839787160055, -1.2506254355060022, -1.7861102263080042, 1.57664954662323, 1.3234407901763916], [0.16836562752723694, -1.6638758818255823, -1.2618640104876917, -1.7730205694781702, 1.576493740081787, 1.3242789506912231], [0.1684255450963974, -1.665947739277975, -1.2732108275042933, -1.7595112959491175, 1.5765776634216309, 1.32449471950531], [0.168461874127388, -1.6685588995562952, -1.2868483702289026, -1.7433770338641565, 1.5764458179473877, 1.3246265649795532], [0.1684379130601883, -1.67076284090151, -1.2992385069476526, -1.728741470967428, 1.5765537023544312, 1.3247703313827515], [0.1684015840291977, -1.6733134428607386, -1.3129485289203089, -1.7123802343951624, 1.5763978958129883, 1.3250452280044556], [0.16835364699363708, -1.6761277357684534, -1.3281696478473108, -1.694472614918844, 1.576493740081787, 1.3252968788146973], [0.16828174889087677, -1.6796248594867151, -1.347433869038717, -1.6716755072223108, 1.5763379335403442, 1.3254166841506958], [0.16822181642055511, -1.6830146948443812, -1.365570370350973, -1.6501253286944788, 1.5763260126113892, 1.3256800174713135], [0.16813793778419495, -1.6866558233844202, -1.3851583639727991, -1.6269696394549769, 1.5761581659317017, 1.3258477449417114], [0.16804206371307373, -1.6905720869647425, -1.4057300726519983, -1.6022322813617151, 1.5761462450027466, 1.3261470794677734], [0.16795817017555237, -1.695327107106344, -1.430596653615133, -1.572869602833883, 1.5760623216629028, 1.3263866901397705], [0.1678866297006607, -1.6992552916156214, -1.451876465474264, -1.5477741400348108, 1.576134204864502, 1.3266264200210571], [0.16775481402873993, -1.7031596342669886, -1.4729049841510218, -1.522475544606344, 1.5760983228683472, 1.326805830001831], [0.16764695942401886, -1.7078068892108362, -1.4976046721087855, -1.4934266249286097, 1.5760023593902588, 1.3271409273147583], [0.1675151288509369, -1.7116392294513147, -1.5189817587481897, -1.4682729879962366, 1.5759180784225464, 1.3272724151611328], [0.16746719181537628, -1.7154839674579065, -1.539830509816305, -1.443132225667135, 1.5757619142532349, 1.327571988105774], [0.16738329827785492, -1.719520394002096, -1.5609195868121546, -1.418243710194723, 1.5758578777313232, 1.3278117179870605], [0.16725146770477295, -1.724119011555807, -1.5857999960528772, -1.3888261953936976, 1.5757379531860352, 1.3281229734420776], [0.16713163256645203, -1.7281196753131312, -1.6069377104388636, -1.3636634985553187, 1.5758578777313232, 1.328338623046875], [0.16705971956253052, -1.7320597807513636, -1.6280878225909632, -1.3383811155902308, 1.5757858753204346, 1.3284584283828735], [0.16695186495780945, -1.7360485235797327, -1.6492612997638147, -1.3133395353900355, 1.5756781101226807, 1.32881760597229], [0.16687996685504913, -1.740539852772848, -1.6740830580340784, -1.2839372793780726, 1.5756900310516357, 1.328973412513733], [0.16677209734916687, -1.74440843263735, -1.695148770009176, -1.2586453596698206, 1.5755821466445923, 1.3293086290359497], [0.16667622327804565, -1.7483847776996058, -1.7162392775165003, -1.2336295286761683, 1.575594186782837, 1.3295120000839233], [0.16659197211265564, -1.7530563513385218, -1.7411330381976526, -1.2042048613177698, 1.575438380241394, 1.329787254333496], [0.16648410260677338, -1.7570322195636194, -1.7622836271869105, -1.1790230909930628, 1.5754743814468384, 1.330014944076538], [0.16636426746845245, -1.76097280183901, -1.783314053212301, -1.1538527647601526, 1.5753065347671509, 1.3303022384643555], [0.16631633043289185, -1.7650330702411097, -1.8046210447894495, -1.1288517157184046, 1.5751986503601074, 1.330422043800354], [0.16613656282424927, -1.769512955342428, -1.8295028845416468, -1.0996697584735315, 1.5753185749053955, 1.3307695388793945], [0.1660889983177185, -1.7733214537249964, -1.850222412739889, -1.0749090353595179, 1.575138807296753, 1.3309849500656128], [0.1660171002149582, -1.777022663746969, -1.8699334303485315, -1.0515263716327112, 1.5751627683639526, 1.3312126398086548], [0.16589725017547607, -1.7804721037494105, -1.8884814421283167, -1.0295937697040003, 1.575150728225708, 1.3314403295516968], [0.1658133715391159, -1.7840893904315394, -1.9079163710223597, -1.0063675085650843, 1.5750788450241089, 1.331607699394226], [0.16575343906879425, -1.7870238463031214, -1.923549000416891, -0.9880417029010218, 1.5751267671585083, 1.331799030303955], [0.16575343906879425, -1.7897189299212855, -1.9373815695392054, -0.971236530934469, 1.5750669240951538, 1.3319668769836426], [0.16564558446407318, -1.792377773915426, -1.9522703329669397, -0.9538205305682581, 1.5750188827514648, 1.3321462869644165], [0.16556169092655182, -1.7944734732257288, -1.9632118383990687, -0.9406216780291956, 1.5749709606170654, 1.3322181701660156], [0.16557368636131287, -1.7962225119220179, -1.97290546098818, -0.9290149847613733, 1.574886679649353, 1.332326054573059], [0.1655137538909912, -1.7977197805987757, -1.9813993612872522, -0.91913348833193, 1.5748627185821533, 1.332433819770813], [0.16552574932575226, -1.799265209828512, -1.9894254843341272, -0.9094675222979944, 1.5748507976531982, 1.332493782043457], [0.1654418557882309, -1.8002951780902308, -1.9947760740863245, -0.9029877821551722, 1.574814796447754, 1.3325656652450562], [0.1654658168554306, -1.8010733763324183, -1.9989631811725062, -0.8982332388507288, 1.5749350786209106, 1.3326252698898315], [0.16541787981987, -1.8015168348895472, -2.0016143957721155, -0.8950112501727503, 1.5748268365859985, 1.3327211141586304], [0.1653939187526703, -1.8016722838031214, -2.0031383673297327, -0.893310848866598, 1.5749350786209106, 1.3327211141586304], [0.1653939187526703, -1.8016603628741663, -2.0030539671527308, -0.8933585325824183, 1.5747429132461548, 1.332685112953186], [0.1653699427843094, -1.8016842047320765, -2.0030787626849573, -0.8933704535113733, 1.5747309923171997, 1.332685112953186], [0.16540589928627014, -1.8016842047320765, -2.003090206776754, -0.8933704535113733, 1.5747549533843994, 1.3327091932296753], [0.16540589928627014, -1.8016966024981897, -2.0031026045428675, -0.8933346907245081, 1.5747429132461548, 1.3326971530914307], [0.16538193821907043, -1.8017204443561, -2.0031026045428675, -0.8933704535113733, 1.5747429132461548, 1.332673192024231], [0.1653939187526703, -1.80174428621401, -2.0030420462237757, -0.8933466116534632, 1.5747908353805542, 1.3327211141586304], [0.1653939187526703, -1.8017562071429651, -2.003090206776754, -0.8932989279376429, 1.5747309923171997, 1.3327091932296753], [0.16540589928627014, -1.8017924467669886, -2.0030787626849573, -0.8932507673846644, 1.5747309923171997, 1.332733154296875], [0.1653699427843094, -1.8018401304828089, -2.0031140486346644, -0.8932746092425745, 1.5747549533843994, 1.3327091932296753], [0.16540589928627014, -1.801863972340719, -2.0030539671527308, -0.8932746092425745, 1.5747429132461548, 1.3327211141586304], [0.16540589928627014, -1.8018162886248987, -2.003066364918844, -0.8932507673846644, 1.5747789144515991, 1.3327091932296753], [0.1653939187526703, -1.801852051411764, -2.003066364918844, -0.8932507673846644, 1.5747789144515991, 1.3327211141586304], [0.1653939187526703, -1.8018401304828089, -2.003066364918844, -0.8932746092425745, 1.5747908353805542, 1.3327211141586304], [0.1653939187526703, -1.8018401304828089, -2.0030787626849573, -0.8932626883136194, 1.5747549533843994, 1.3327211141586304], [0.1653939187526703, -1.8018282095538538, -2.003090206776754, -0.8932746092425745, 1.5747789144515991, 1.3327091932296753], [0.1653699427843094, -1.801852051411764, -2.003090206776754, -0.8932388464557093, 1.5747668743133545, 1.332733154296875], [0.16540589928627014, -1.801852051411764, -2.0031026045428675, -0.8932507673846644, 1.5747908353805542, 1.3327571153640747], [0.16541787981987, -1.8018763701068323, -2.003090206776754, -0.8932269255267542, 1.5747549533843994, 1.3327091932296753], [0.1653939187526703, -1.801852051411764, -2.0031026045428675, -0.8932507673846644, 1.5747908353805542, 1.3327091932296753], [0.16538193821907043, -1.8019002119647425, -2.003090206776754, -0.8932746092425745, 1.5747908353805542, 1.3326971530914307], [0.1653699427843094, -1.8018882910357874, -2.0031026045428675, -0.8932507673846644, 1.5747789144515991, 1.332733154296875], [0.16538193821907043, -1.8018763701068323, -2.0031140486346644, -0.8932388464557093, 1.5747789144515991, 1.332733154296875], [0.16538193821907043, -1.8018763701068323, -2.0031264464007776, -0.8932150045977991, 1.574814796447754, 1.332685112953186], [0.16541787981987, -1.801863972340719, -2.0031140486346644, -0.8932150045977991, 1.5748028755187988, 1.3327211141586304], [0.16535796225070953, -1.801852051411764, -2.003090206776754, -0.8932269255267542, 1.5747908353805542, 1.332733154296875], [0.16541787981987, -1.801863972340719, -2.003066364918844, -0.8932269255267542, 1.5747668743133545, 1.3327211141586304], [0.16538193821907043, -1.8018763701068323, -2.0031140486346644, -0.8932269255267542, 1.5747789144515991, 1.332733154296875], [0.16538193821907043, -1.801852051411764, -2.003090206776754, -0.8932507673846644, 1.574814796447754, 1.332733154296875], [0.1653939187526703, -1.8018882910357874, -2.0030787626849573, -0.8932626883136194, 1.5747908353805542, 1.332733154296875], [0.16534598171710968, -1.8018882910357874, -2.003090206776754, -0.8932269255267542, 1.5748028755187988, 1.332733154296875], [0.16534598171710968, -1.8018882910357874, -2.0031026045428675, -0.8932150045977991, 1.5747668743133545, 1.3327571153640747], [0.16538193821907043, -1.8018882910357874, -2.0031140486346644, -0.8932870070086878, 1.5747668743133545, 1.332733154296875], [0.16540589928627014, -1.801852051411764, -2.003090206776754, -0.8932150045977991, 1.5747789144515991, 1.3327091932296753], [0.16540589928627014, -1.8018763701068323, -2.0030787626849573, -0.8932269255267542, 1.5747908353805542, 1.3327211141586304], [0.16540589928627014, -1.8018763701068323, -2.0031026045428675, -0.8932269255267542, 1.5747908353805542, 1.33274507522583], [0.16538193821907043, -1.8018763701068323, -2.003090206776754, -0.8932626883136194, 1.5747908353805542, 1.332733154296875], [0.16538193821907043, -1.8018882910357874, -2.003090206776754, -0.8931906859027308, 1.5747908353805542, 1.33274507522583], [0.1653699427843094, -1.8018882910357874, -2.0031264464007776, -0.8932269255267542, 1.5747789144515991, 1.3326971530914307], [0.16535796225070953, -1.8019121328936976, -2.0031026045428675, -0.8932388464557093, 1.5747789144515991, 1.3326971530914307], [0.16538193821907043, -1.8018763701068323, -2.003066364918844, -0.8932388464557093, 1.5747908353805542, 1.3327091932296753], [0.16538193821907043, -1.8019002119647425, -2.003066364918844, -0.8932150045977991, 1.5747908353805542, 1.33274507522583], [0.16534598171710968, -1.8018763701068323, -2.0031140486346644, -0.8932269255267542, 1.5748028755187988, 1.3327091932296753], [0.16535796225070953, -1.8019121328936976, -2.003090206776754, -0.8932388464557093, 1.5747789144515991, 1.3326971530914307], [0.16538193821907043, -1.8018763701068323, -2.0030787626849573, -0.8932388464557093, 1.5747908353805542, 1.3327091932296753], [0.16538193821907043, -1.8018882910357874, -2.0031140486346644, -0.8932150045977991, 1.5747789144515991, 1.3327091932296753], [0.16535796225070953, -1.8019002119647425, -2.0031264464007776, -0.8932150045977991, 1.5747668743133545, 1.3327211141586304], [0.1653699427843094, -1.8019121328936976, -2.003090206776754, -0.893203083668844, 1.5748268365859985, 1.332733154296875], [0.16538193821907043, -1.801863972340719, -2.0031140486346644, -0.8932150045977991, 1.5747668743133545, 1.3327211141586304], [0.16534598171710968, -1.8019002119647425, -2.0030787626849573, -0.8932507673846644, 1.5747668743133545, 1.3327091932296753], [0.16538193821907043, -1.8019121328936976, -2.0031383673297327, -0.8932150045977991, 1.5747429132461548, 1.3326971530914307], [0.16534598171710968, -1.8019240538226526, -2.0031140486346644, -0.893203083668844, 1.5747549533843994, 1.3326971530914307], [0.1653939187526703, -1.8019121328936976, -2.003090206776754, -0.8932150045977991, 1.5747789144515991, 1.3327211141586304], [0.16538193821907043, -1.8019121328936976, -2.0030787626849573, -0.8932269255267542, 1.5747908353805542, 1.3327571153640747], [0.16538193821907043, -1.801852051411764, -2.003066364918844, -0.8932150045977991, 1.5747668743133545, 1.3327211141586304], [0.16535796225070953, -1.8019121328936976, -2.003090206776754, -0.8932269255267542, 1.5747789144515991, 1.3327211141586304], [0.16538193821907043, -1.8019002119647425, -2.0031140486346644, -0.893203083668844, 1.5747789144515991, 1.3327211141586304], [0.16538193821907043, -1.8019002119647425, -2.0030787626849573, -0.8932388464557093, 1.5747668743133545, 1.332733154296875], [0.1653699427843094, -1.801863972340719, -2.0031140486346644, -0.8932269255267542, 1.5747789144515991, 1.3327211141586304], [0.16535796225070953, -1.801863972340719, -2.0030787626849573, -0.893203083668844, 1.5747789144515991, 1.3327091932296753], [0.1653699427843094, -1.8018882910357874, -2.0031026045428675, -0.8932388464557093, 1.5747789144515991, 1.3327571153640747], [0.16538193821907043, -1.8019002119647425, -2.0027182737933558, -0.8937180677997034, 1.5748028755187988, 1.33274507522583], [0.16535796225070953, -1.8015888373004358, -2.000571076069967, -0.8960536162005823, 1.5747789144515991, 1.33274507522583], [0.16534598171710968, -1.8010261694537562, -1.997307602559225, -0.9001496473895472, 1.5749590396881104, 1.332733154296875], [0.16538193821907043, -1.8001273314105433, -1.9925444761859339, -0.9057911078082483, 1.5748987197875977, 1.3326611518859863], [0.16540589928627014, -1.7990015188800257, -1.986450497304098, -0.913037125264303, 1.574814796447754, 1.3326016664505005], [0.16540589928627014, -1.797157112752096, -1.977584187184469, -0.9234812895404261, 1.5749590396881104, 1.3325177431106567], [0.1654418557882309, -1.7954562346087855, -1.9685981909381312, -0.9340933004962366, 1.5748987197875977, 1.3324098587036133], [0.16552574932575226, -1.7934916655169886, -1.95825702348818, -0.94653827348818, 1.5748387575149536, 1.3323379755020142], [0.16556169092655182, -1.7909167448626917, -1.944291893635885, -0.9626959005938929, 1.5749590396881104, 1.3321462869644165], [0.16562162339687347, -1.7883895079242151, -1.9311073462115687, -0.978614632283346, 1.574923038482666, 1.3319908380508423], [0.1656935214996338, -1.7856219450580042, -1.9163983503924769, -0.9959705511676233, 1.5750069618225098, 1.331847071647644], [0.165789395570755, -1.782651726399557, -1.9004061857806605, -1.0152314344989222, 1.5750788450241089, 1.3316316604614258], [0.16589725017547607, -1.7789033094989222, -1.8798311392413538, -1.0393202940570276, 1.5750669240951538, 1.3314998149871826], [0.16595718264579773, -1.7754176298724573, -1.8610437552081507, -1.0618165175067347, 1.5752586126327515, 1.331188678741455], [0.1660410612821579, -1.7716687361346644, -1.8406122366534632, -1.0857623259173792, 1.5752226114273071, 1.331056833267212], [0.1661129742860794, -1.7677162329303187, -1.8193414847003382, -1.1109898726092737, 1.575150728225708, 1.3307336568832397], [0.16622045636177063, -1.7631648222552698, -1.7946279684649866, -1.1403163115130823, 1.5753904581069946, 1.3305299282073975], [0.16634029150009155, -1.7590926329242151, -1.7733929792987269, -1.1654370466815394, 1.5752825736999512, 1.3302781581878662], [0.16646014153957367, -1.7551520506488245, -1.7521222273456019, -1.190547291432516, 1.575366497039795, 1.3300509452819824], [0.16656799614429474, -1.750636402760641, -1.7274687925921839, -1.2198517958270472, 1.5753904581069946, 1.3298112154006958], [0.1666642427444458, -1.746636215840475, -1.706306282673971, -1.2449992338763636, 1.5754863023757935, 1.329535961151123], [0.16674813628196716, -1.7426956335650843, -1.6850956122027796, -1.270038906727926, 1.5757020711898804, 1.3293086290359497], [0.16684401035308838, -1.738791290913717, -1.66394550005068, -1.2953789869891565, 1.575594186782837, 1.3291049003601074], [0.16697584092617035, -1.7342036406146448, -1.6393287817584437, -1.3248303572284144, 1.5757020711898804, 1.3288415670394897], [0.1670357584953308, -1.7301319281207483, -1.6179984251605433, -1.3499558607684534, 1.5757379531860352, 1.3285540342330933], [0.16713163256645203, -1.726203743611471, -1.5967887083636683, -1.3749869505511683, 1.5756781101226807, 1.328338623046875], [0.16722750663757324, -1.7222626844989222, -1.5756872336017054, -1.4001734892474573, 1.5757979154586792, 1.328050971031189], [0.1673114001750946, -1.717663590108053, -1.550938908253805, -1.4294117132769983, 1.5758821964263916, 1.3278472423553467], [0.16743123531341553, -1.7137349287616175, -1.5296457449542444, -1.4546483198748987, 1.5760383605957031, 1.327631950378418], [0.16752710938453674, -1.7098787466632288, -1.5085929075824183, -1.479873005543844, 1.5760862827301025, 1.3273563385009766], [0.16757504642009735, -1.7052434126483362, -1.4838689009295862, -1.5091012159930628, 1.5761102437973022, 1.3270690441131592], [0.16769489645957947, -1.7012789885150355, -1.4626243750201624, -1.534255329762594, 1.576134204864502, 1.326805830001831], [0.16782671213150024, -1.697338883076803, -1.4414642492877405, -1.559507195149557, 1.5760983228683472, 1.3266503810882568], [0.1678866297006607, -1.6933029333697718, -1.4202802816974085, -1.5847461859332483, 1.5762181282043457, 1.3263747692108154], [0.16799412667751312, -1.6887276808368128, -1.3955820242511194, -1.614037815724508, 1.5761222839355469, 1.3260871171951294], [0.16809000074863434, -1.6850150267230433, -1.3753579298602503, -1.6380561033831995, 1.5763260126113892, 1.3258237838745117], [0.16816189885139465, -1.6815059820758265, -1.3570173422442835, -1.6600611845599573, 1.576361894607544, 1.325692057609558], [0.16825777292251587, -1.678283993397848, -1.3393009344684046, -1.6807125250445765, 1.5762660503387451, 1.3255242109298706], [0.16829372942447662, -1.6748469511615198, -1.3208172957049769, -1.70294696489443, 1.576361894607544, 1.3253328800201416], [0.16835364699363708, -1.672079865132467, -1.3062074820147913, -1.7200630346881312, 1.5763379335403442, 1.3251291513442993], [0.168461874127388, -1.6696246306048792, -1.2931330839740198, -1.7357056776629847, 1.5765776634216309, 1.3249852657318115], [0.1685098111629486, -1.667121712361471, -1.2792318503009241, -1.7520197073565882, 1.5763858556747437, 1.3247942924499512], [0.168461874127388, -1.6649177710162562, -1.2678006331073206, -1.7658045927630823, 1.5765656232833862, 1.3244826793670654], [0.16816189885139465, -1.6628578344928187, -1.256406609212057, -1.7791460196124476, 1.5765776634216309, 1.323788046836853], [0.16734734177589417, -1.6609295050250452, -1.245444122944967, -1.7921398321734827, 1.5765297412872314, 1.3227940797805786], [0.1654418557882309, -1.6589658896075647, -1.2335098425494593, -1.8060572783099573, 1.5766735076904297, 1.320770263671875], [0.1627809852361679, -1.6575282255755823, -1.2238906065570276, -1.8171570936786097, 1.576589584350586, 1.3179805278778076], [0.15912578999996185, -1.6563428084002894, -1.2149556318866175, -1.827191177998678, 1.5767697095870972, 1.314315915107727], [0.15466803312301636, -1.6555283705340784, -1.2072070280658167, -1.8360379377948206, 1.5769734382629395, 1.3096462488174438], [0.14780069887638092, -1.654797379170553, -1.1991475264178675, -1.8447888533221644, 1.5769734382629395, 1.3028923273086548], [0.14074161648750305, -1.654677693043844, -1.193066422139303, -1.851046387349264, 1.5771892070770264, 1.2957674264907837], [0.13243654370307922, -1.6547496954547327, -1.1880410353290003, -1.8559616247760218, 1.5772850513458252, 1.2873611450195312], [0.12137473374605179, -1.6551573912249964, -1.1833041349994105, -1.860133473073141, 1.577368974685669, 1.2763091325759888], [0.11092374473810196, -1.6557558218585413, -1.1801374594317835, -1.8626745382892054, 1.577500820159912, 1.2658195495605469], [0.09946645051240921, -1.6567137877093714, -1.177762810383932, -1.8641613165484827, 1.5775247812271118, 1.2543359994888306], [0.08739758282899857, -1.6578996817218226, -1.1758440176593226, -1.8650124708758753, 1.5778007507324219, 1.2422541379928589], [0.07285959273576736, -1.6594207922564905, -1.173924748097555, -1.8655279318438929, 1.57792067527771, 1.227825403213501], [0.05980765074491501, -1.6607616583453577, -1.1723654905902308, -1.8655999342547815, 1.5781962871551514, 1.2146780490875244], [0.04523370787501335, -1.6623066107379358, -1.1705783049212855, -1.866091553364889, 1.5784119367599487, 1.2000455856323242], [0.028801463544368744, -1.663959805165426, -1.1686480681048792, -1.866223160420553, 1.5784598588943481, 1.1836419105529785], [0.0078028542920947075, -1.6661513487445276, -1.1660330931292933, -1.8667147795306605, 1.5789157152175903, 1.1627237796783447], [-0.011997524891988576, -1.668187443410055, -1.163706127797262, -1.867242161427633, 1.5789875984191895, 1.1429318189620972], [-0.03344089189638311, -1.6703670660602015, -1.161055866871969, -1.8677094618426722, 1.57933509349823, 1.1214995384216309], [-0.06042176881899053, -1.6730616728412073, -1.157769505177633, -1.8683565298663538, 1.5797669887542725, 1.094691514968872], [-0.08495790163149053, -1.6755889097796839, -1.1547234694110315, -1.8688367048846644, 1.5799226760864258, 1.069787621498108], [-0.1101301352130335, -1.6780923048602503, -1.1516888777362269, -1.8695200125323694, 1.5802342891693115, 1.0446566343307495], [-0.13537437120546514, -1.6807268301593226, -1.1486428419696253, -1.8700950781451624, 1.580618143081665, 1.0193579196929932], [-0.16458684602846319, -1.6837452093707483, -1.1450923124896448, -1.8708503882037562, 1.5809897184371948, 0.9899651408195496], [-0.18982011476625615, -1.6863201300250452, -1.1420343557940882, -1.8714378515826624, 1.581337571144104, 0.9648233652114868], [-0.21481401125063115, -1.6889193693744105, -1.1391204039203089, -1.8720019499408167, 1.5817691087722778, 0.9396692514419556], [-0.23998862901796514, -1.6915181318866175, -1.1360018889056605, -1.8726847807513636, 1.582008719444275, 0.9146472811698914], [-0.26922685304750615, -1.694536034260885, -1.1324642340289515, -1.8732603232013147, 1.5824764966964722, 0.8852556347846985], [-0.2945340315448206, -1.6970871130572718, -1.129345719014303, -1.8738959471331995, 1.582692265510559, 0.8601022362709045], [-0.3196976820575159, -1.6997340361224573, -1.126383129750387, -1.8743389288531702, 1.583135962486267, 0.8348653316497803], [-0.34904605547060186, -1.7027166525470179, -1.1227133909808558, -1.8750823179828089, 1.5834954977035522, 0.805450439453125], [-0.3741386572467249, -1.7052314917193812, -1.119751278554098, -1.875645939503805, 1.5836992263793945, 0.7803097367286682], [-0.3993037382708948, -1.7077706495868128, -1.1166570822345179, -1.8763054052936, 1.5841909646987915, 0.7552170157432556], [-0.42442113557924444, -1.7102621237384241, -1.113718334828512, -1.8769286314593714, 1.5844067335128784, 0.7301359176635742], [-0.4536388556109827, -1.7133162657367151, -1.1100967566119593, -1.8775642553912562, 1.584862470626831, 0.7008172869682312], [-0.47874576250185186, -1.7158673445331019, -1.1070869604693812, -1.8783429304706019, 1.5851620435714722, 0.675665020942688], [-0.503756348286764, -1.7185257116900843, -1.1040166060077112, -1.878786865864889, 1.5856773853302002, 0.6504527926445007], [-0.5288155714618128, -1.7210891882525843, -1.10101825395693, -1.8794344107257288, 1.5858938694000244, 0.6253129243850708], [-0.5581429640399378, -1.7240713278399866, -1.097396198903219, -1.8801534811602991, 1.5863373279571533, 0.5959702730178833], [-0.5832145849810999, -1.726682488118307, -1.0943263212787073, -1.8807528654681605, 1.586625337600708, 0.5708898901939392], [-0.6084068457232874, -1.7292817274676722, -1.0913165251361292, -1.881268326436178, 1.5869488716125488, 0.5457732081413269], [-0.6376765410052698, -1.7323358694659632, -1.087790314351217, -1.8820231596576136, 1.5873442888259888, 0.5164070129394531], [-0.6630728880511683, -1.7347906271563929, -1.0847919623004358, -1.882623020802633, 1.5874521732330322, 0.4912663400173187], [-0.6881941000567835, -1.7373178640948694, -1.081721607838766, -1.883270565663473, 1.5879799127578735, 0.466185986995697], [-0.7133153120623987, -1.7398932615863245, -1.0787237326251429, -1.8837736288653772, 1.5883034467697144, 0.44100937247276306], [-0.7425621191607874, -1.7428634802447718, -1.075209919606344, -1.8843854109393519, 1.5886993408203125, 0.4118345379829407], [-0.7677562872516077, -1.7454388777362269, -1.0721281210528772, -1.8851283232318323, 1.5891906023025513, 0.38663357496261597], [-0.7928183714496058, -1.748049561177389, -1.0689976851092737, -1.8857043425189417, 1.5894306898117065, 0.36148056387901306], [-0.817425552998678, -1.7505887190448206, -1.0659516493426722, -1.8861716429339808, 1.5896823406219482, 0.33633953332901], [-0.846985165272848, -1.7536910215960901, -1.062402073537008, -1.8869388739215296, 1.5901257991790771, 0.3069482147693634], [-0.872204605733053, -1.756265942250387, -1.0593679586993616, -1.8875144163714808, 1.5904498100280762, 0.28174689412117004], [-0.897076431904928, -1.758841339741842, -1.0563462416278284, -1.8881133238421839, 1.5908212661743164, 0.25673654675483704], [-0.9264567534076136, -1.7618830839740198, -1.0527718702899378, -1.8888686339007776, 1.5913609266281128, 0.2274283915758133], [-0.9516766707049769, -1.7644828001605433, -1.0497620741473597, -1.8893244902240198, 1.5914567708969116, 0.20232181251049042], [-0.9767649809466761, -1.7669857184039515, -1.0467637220965784, -1.8899839560138147, 1.5919721126556396, 0.17720362544059753], [-1.0018051306353968, -1.7695005575763147, -1.04370624223818, -1.8905952612506312, 1.5921882390975952, 0.1520966738462448], [-1.0293400923358362, -1.7721956411944788, -1.0403602758990687, -1.8912184874164026, 1.5926796197891235, 0.12469062209129333], [-1.0510829130755823, -1.7743995825396937, -1.0376856962787073, -1.8917220274554651, 1.592727541923523, 0.10299542546272278], [-1.0713027159320276, -1.7765315214740198, -1.0352156797992151, -1.8922136465655726, 1.593231201171875, 0.08289264142513275], [-1.0897114912616175, -1.7785080114947718, -1.0330451170550745, -1.8926332632647913, 1.5934109687805176, 0.06434592604637146], [-1.1092599073993128, -1.780520264302389, -1.0306227842914026, -1.8930047194110315, 1.5938547849655151, 0.04479328915476799], [-1.1243341604815882, -1.7819932142840784, -1.0288355986224573, -1.8934124151812952, 1.5939147472381592, 0.029766568914055824], [-1.1376946608172815, -1.7834308783160608, -1.027252499257223, -1.8937600294696253, 1.5941663980484009, 0.016595905646681786], [-1.1516788641559046, -1.7848318258868616, -1.0255258719073694, -1.8940838019000452, 1.5943820476531982, 0.0024309251457452774], [-1.1634076277362269, -1.7861140410052698, -1.02460223833193, -1.8938682715045374, 1.5944539308547974, -0.009123627339498341], [-1.1743810812579554, -1.7873356978045862, -1.0247100035296839, -1.8928611914264124, 1.5945981740951538, -0.020223442708150685], [-1.1847556273089808, -1.788616959248678, -1.0260174910174769, -1.8904030958758753, 1.5948622226715088, -0.03059274355043584], [-1.1956084410296839, -1.790138069783346, -1.029339615498678, -1.8855846563922327, 1.5949101448059082, -0.04128581682314092], [-1.20374042192568, -1.7913597265826624, -1.0337641874896448, -1.8798535505877894, 1.5951378345489502, -0.049344841633931935], [-1.2108038107501429, -1.7926057020770472, -1.0394967238055628, -1.87294847169985, 1.5951977968215942, -0.056325737630025685], [-1.2165845076190394, -1.7938273588763636, -1.046379868184225, -1.8648446241961878, 1.59516179561615, -0.06214505830873662], [-1.2219579855548304, -1.7951329390155237, -1.0557225386248987, -1.8540914694415491, 1.5954254865646362, -0.06731778780092412], [-1.2254474798785608, -1.7962225119220179, -1.0647285620318812, -1.8442252318011683, 1.5953176021575928, -0.07070666948427373], [-1.2280381361590784, -1.7972763220416468, -1.0741546789752405, -1.833724323903219, 1.5953655242919922, -0.0731738249408167], [-1.2301009337054651, -1.7983906904803675, -1.0855119864093226, -1.821017090474264, 1.5953295230865479, -0.07494575182069951], [-1.23108417192568, -1.799277130757467, -1.0959332625018519, -1.8098328749286097, 1.595389485359192, -0.07576018968691045], [-1.2315877119647425, -1.800211254750387, -1.106774632130758, -1.7981937567340296, 1.5954134464263916, -0.07607108751405889], [-1.2316840330706995, -1.801145378743307, -1.1181319395648401, -1.7856667677508753, 1.5954015254974365, -0.07607108751405889], [-1.2317078749286097, -1.8022831122027796, -1.1329196135150355, -1.769843880330221, 1.5954015254974365, -0.07596332231630498], [-1.2317679564105433, -1.8034327665912073, -1.1469276587115687, -1.754716698323385, 1.5954134464263916, -0.07592755952943975], [-1.231851879750387, -1.8047149817096155, -1.1627228895770472, -1.738018814717428, 1.5954134464263916, -0.07580787340273076], [-1.2319238821612757, -1.8060677687274378, -1.1796816031085413, -1.7194398085223597, 1.5954015254974365, -0.07566386858095342], [-1.2320316473590296, -1.807828728352682, -1.2017138640033167, -1.6959226767169397, 1.595389485359192, -0.07544881502260381], [-1.2321036497699183, -1.8094218412982386, -1.221947971974508, -1.6739409605609339, 1.5954015254974365, -0.07526904741396123], [-1.2322233358966272, -1.811218563710348, -1.2438367048846644, -1.650245491658346, 1.5953655242919922, -0.07500583330263311], [-1.2322834173785608, -1.8133624235736292, -1.271003548298971, -1.6210487524615687, 1.5953055620193481, -0.07465869585146123], [-1.2323434988604944, -1.8151829878436487, -1.294225041066305, -1.595844570790426, 1.5952816009521484, -0.07446700731386358], [-1.2324517408954065, -1.8170040289508265, -1.3175180594073694, -1.5706403891192835, 1.595293641090393, -0.07416755357851201], [-1.2325356642352503, -1.8189204374896448, -1.340656582509176, -1.5456169287311, 1.5952457189559937, -0.0739520231830042], [-1.2326434294330042, -1.8211362997638147, -1.3678730169879358, -1.516291920338766, 1.5951738357543945, -0.07365256944765264], [-1.2327154318438929, -1.8229087034808558, -1.3913596312152308, -1.4911254088031214, 1.595233678817749, -0.07336503664125615], [-1.2327869574176233, -1.8247655073748987, -1.4144628683673304, -1.4658406416522425, 1.5950539112091064, -0.07312566438783819], [-1.2328713575946253, -1.826681915913717, -1.437697712575094, -1.440483872090475, 1.59516179561615, -0.07288581529726201], [-1.2329791227923792, -1.8288500944720667, -1.4648321310626429, -1.4113414923297327, 1.5950539112091064, -0.07263452211488897], [-1.2330992857562464, -1.8306587378131312, -1.4881756941424769, -1.386130158101217, 1.5951857566833496, -0.07229930559267217], [-1.2331588904010218, -1.8324311415301722, -1.5115440527545374, -1.3611472288714808, 1.5950899124145508, -0.07211953798402959], [-1.2332189718829554, -1.8342397848712366, -1.5343964735614222, -1.33598500887026, 1.5950299501419067, -0.07180864015688115], [-1.2333148161517542, -1.8364556471454065, -1.5614717642413538, -1.306821648274557, 1.595005989074707, -0.0714495817767542], [-1.2334111372577112, -1.8383844534503382, -1.5849726835833948, -1.2815764586078089, 1.5951378345489502, -0.07122165361513311], [-1.23350698152651, -1.8401692549334925, -1.6082094351397913, -1.2564767042743128, 1.5950778722763062, -0.07097036043276006], [-1.2335909048663538, -1.842241112385885, -1.6340497175799769, -1.2286575476275843, 1.5951138734817505, -0.07062322298158819], [-1.2336385885821741, -1.8439539114581507, -1.6544082800494593, -1.2064335981952112, 1.5949220657348633, -0.07035953203310186], [-1.233734432850973, -1.8454397360431116, -1.6735790411578577, -1.1858752409564417, 1.5951138734817505, -0.0702279249774378], [-1.2337825934039515, -1.8467567602740687, -1.6910222212420862, -1.1669829527484339, 1.5950539112091064, -0.07003623643984014], [-1.2338183561908167, -1.848302189503805, -1.7095330397235315, -1.1469648520099085, 1.5950899124145508, -0.06979686418642217], [-1.2338665167437952, -1.8494518438922327, -1.7238815466510218, -1.1316426436053675, 1.5949220657348633, -0.06962949434389287], [-1.2339509169207972, -1.8504703680621546, -1.7368019262896937, -1.1178181807147425, 1.5949101448059082, -0.06950933138002569], [-1.2339509169207972, -1.8514044920550745, -1.7479713598834437, -1.1055877844439905, 1.595005989074707, -0.06937772432436162], [-1.2340343634234827, -1.852314297352926, -1.7594283262835901, -1.0932133833514612, 1.5949580669403076, -0.0692818800555628], [-1.2340706030475062, -1.8529613653766077, -1.7675507704364222, -1.0845282713519495, 1.5950299501419067, -0.06913787523378545], [-1.234046761189596, -1.85344106355776, -1.7740166823016565, -1.0774605909930628, 1.5948861837387085, -0.06904203096498662], [-1.2340944449054163, -1.853907887135641, -1.7798469702350062, -1.0711119810687464, 1.5949101448059082, -0.06903011003603154], [-1.2340944449054163, -1.8540871779071253, -1.7832306067096155, -1.067469898854391, 1.5949101448059082, -0.06891042390932256], [-1.2341306845294397, -1.8541949431048792, -1.785245720540182, -1.06537372270693, 1.594934105873108, -0.0688865820514124], [-1.2340944449054163, -1.8542311827289026, -1.7855218092547815, -1.0650141874896448, 1.5949701070785522, -0.06892282167543584], [-1.2341182867633265, -1.8541949431048792, -1.7855694929706019, -1.0650504271136683, 1.594946026802063, -0.0688865820514124], [-1.2341426054583948, -1.854171101246969, -1.7855694929706019, -1.0650623480426233, 1.5949580669403076, -0.06891042390932256], [-1.2340944449054163, -1.8541949431048792, -1.7855456511126917, -1.065026585255758, 1.5949580669403076, -0.06892282167543584], [-1.2341426054583948, -1.8542431036578577, -1.7855818907367151, -1.0650022665606897, 1.594994068145752, -0.0688865820514124], [-1.2341426054583948, -1.8543151060687464, -1.7855694929706019, -1.0650504271136683, 1.5949580669403076, -0.06886274019350225], [-1.2341426054583948, -1.8543389479266565, -1.7855818907367151, -1.065026585255758, 1.5949580669403076, -0.06889850298036748], [-1.2341306845294397, -1.8543270269977015, -1.7855694929706019, -1.0650504271136683, 1.594946026802063, -0.0688865820514124], [-1.2341426054583948, -1.8543389479266565, -1.7855575720416468, -1.065038029347555, 1.5949580669403076, -0.06889850298036748], [-1.2341426054583948, -1.8543389479266565, -1.7855818907367151, -1.0650141874896448, 1.594934105873108, -0.0688865820514124], [-1.2341426054583948, -1.8543389479266565, -1.7856176535235804, -1.065038029347555, 1.5949580669403076, -0.0688865820514124], [-1.2341426054583948, -1.8543389479266565, -1.7855818907367151, -1.0650504271136683, 1.594946026802063, -0.06889850298036748], [-1.2341426054583948, -1.8543747107135218, -1.7855694929706019, -1.0650504271136683, 1.5949701070785522, -0.06887466112245733], [-1.2341306845294397, -1.8542912642108362, -1.7856057325946253, -1.065038029347555, 1.594934105873108, -0.06887466112245733], [-1.2341182867633265, -1.8543627897845667, -1.7855694929706019, -1.065026585255758, 1.594946026802063, -0.06887466112245733], [-1.2341182867633265, -1.8543389479266565, -1.7855575720416468, -1.065038029347555, 1.5949580669403076, -0.06889850298036748], [-1.2341426054583948, -1.8543508688556116, -1.7855575720416468, -1.0650141874896448, 1.5949580669403076, -0.06887466112245733], [-1.2341306845294397, -1.8543747107135218, -1.7855818907367151, -1.065038029347555, 1.5949580669403076, -0.06889850298036748], [-1.23415452638735, -1.8543389479266565, -1.7855575720416468, -1.065038029347555, 1.5949820280075073, -0.06889850298036748], [-1.234166447316305, -1.8543747107135218, -1.7855456511126917, -1.065038029347555, 1.5949101448059082, -0.0688865820514124], [-1.23415452638735, -1.8543747107135218, -1.7855818907367151, -1.0650141874896448, 1.5949701070785522, -0.06891042390932256], [-1.2341426054583948, -1.8543747107135218, -1.7855694929706019, -1.0650504271136683, 1.594946026802063, -0.06887466112245733], [-1.234166447316305, -1.8543508688556116, -1.7855818907367151, -1.065038029347555, 1.5949580669403076, -0.0688865820514124], [-1.2341426054583948, -1.8543389479266565, -1.7855575720416468, -1.0650504271136683, 1.594946026802063, -0.0688865820514124], [-1.2341182867633265, -1.8543389479266565, -1.7855818907367151, -1.0650141874896448, 1.5949820280075073, -0.06886274019350225], [-1.23415452638735, -1.8543747107135218, -1.7855818907367151, -1.0650504271136683, 1.5949580669403076, -0.0688865820514124], [-1.23415452638735, -1.8543389479266565, -1.7855694929706019, -1.065038029347555, 1.5949580669403076, -0.06883889833559209], [-1.23415452638735, -1.8543389479266565, -1.7855575720416468, -1.065038029347555, 1.5949580669403076, -0.06889850298036748], [-1.23415452638735, -1.8543270269977015, -1.7855575720416468, -1.065026585255758, 1.5949220657348633, -0.06889850298036748], [-1.23415452638735, -1.854387108479635, -1.7855694929706019, -1.065038029347555, 1.594946026802063, -0.0688865820514124], [-1.234166447316305, -1.854387108479635, -1.7855694929706019, -1.065026585255758, 1.5949701070785522, -0.06886274019350225], [-1.2341426054583948, -1.8543627897845667, -1.7855575720416468, -1.065026585255758, 1.5949220657348633, -0.06887466112245733], [-1.23415452638735, -1.854387108479635, -1.785593334828512, -1.0650504271136683, 1.594934105873108, -0.06887466112245733], [-1.2341306845294397, -1.8543627897845667, -1.7855337301837366, -1.065038029347555, 1.5949580669403076, -0.06891042390932256], [-1.234166447316305, -1.8543627897845667, -1.7855818907367151, -1.065038029347555, 1.5949580669403076, -0.06887466112245733], [-1.23415452638735, -1.8543508688556116, -1.7855818907367151, -1.0650504271136683, 1.594934105873108, -0.06889850298036748], [-1.234166447316305, -1.8543990294085901, -1.7855694929706019, -1.065038029347555, 1.5949701070785522, -0.06886274019350225], [-1.23415452638735, -1.8543747107135218, -1.7855694929706019, -1.065038029347555, 1.5949701070785522, -0.0688865820514124], [-1.23415452638735, -1.8544109503375452, -1.7855818907367151, -1.065026585255758, 1.594946026802063, -0.06887466112245733], [-1.2341902891742151, -1.854387108479635, -1.785593334828512, -1.0650141874896448, 1.594934105873108, -0.06889850298036748], [-1.23415452638735, -1.854387108479635, -1.785593334828512, -1.065038029347555, 1.5949220657348633, -0.06891042390932256], [-1.23415452638735, -1.854387108479635, -1.7855818907367151, -1.065038029347555, 1.5949820280075073, -0.06886274019350225], [-1.2341426054583948, -1.8544109503375452, -1.7855575720416468, -1.065038029347555, 1.5949820280075073, -0.0688865820514124], [-1.2341902891742151, -1.8543627897845667, -1.7855818907367151, -1.065038029347555, 1.5949701070785522, -0.06886274019350225], [-1.23415452638735, -1.8543627897845667, -1.7855694929706019, -1.0650504271136683, 1.5949580669403076, -0.06885081926454717], [-1.2341902891742151, -1.8543627897845667, -1.7855694929706019, -1.0650141874896448, 1.5949580669403076, -0.06889850298036748], [-1.234166447316305, -1.854387108479635, -1.7855694929706019, -1.065026585255758, 1.5949820280075073, -0.0688865820514124], [-1.23415452638735, -1.8543747107135218, -1.7855218092547815, -1.065038029347555, 1.5949701070785522, -0.06887466112245733], [-1.234166447316305, -1.8543627897845667, -1.7855694929706019, -1.0650141874896448, 1.5949220657348633, -0.06889850298036748], [-1.2341182867633265, -1.854387108479635, -1.7855456511126917, -1.065038029347555, 1.594946026802063, -0.06886274019350225], [-1.23415452638735, -1.854387108479635, -1.7855575720416468, -1.065038029347555, 1.5949701070785522, -0.06887466112245733], [-1.23415452638735, -1.854387108479635, -1.7855456511126917, -1.0650504271136683, 1.594994068145752, -0.0688865820514124], [-1.23415452638735, -1.8543389479266565, -1.7855575720416468, -1.065026585255758, 1.594994068145752, -0.06889850298036748], [-1.2341306845294397, -1.8543508688556116, -1.7855694929706019, -1.065038029347555, 1.594946026802063, -0.06891042390932256], [-1.234166447316305, -1.8543747107135218, -1.7855694929706019, -1.0650504271136683, 1.5949580669403076, -0.06889850298036748], [-1.2341426054583948, -1.8543747107135218, -1.7855818907367151, -1.0650141874896448, 1.5949701070785522, -0.0688865820514124], [-1.234166447316305, -1.8543990294085901, -1.7855694929706019, -1.0650504271136683, 1.594934105873108, -0.06886274019350225], [-1.2341902891742151, -1.854387108479635, -1.785593334828512, -1.065038029347555, 1.5949580669403076, -0.06885081926454717], [-1.234166447316305, -1.8543990294085901, -1.7855694929706019, -1.0650141874896448, 1.594934105873108, -0.06889850298036748]]

class FixedTraj1Box1PointsUR5(MovingBoxTargetUR5):

    def reset(self, initial_joint_positions = None, type='random'):
        """Environment reset.

        Args:
            initial_joint_positions (list[6] or np.array[6]): robot joint positions in radians.
            ee_target_pose (list[6] or np.array[6]): [x,y,z,r,p,y] target end effector pose.

        Returns:
            np.array: Environment state.

        """
        self.elapsed_steps = 0

        # Set number of trajectory points
        self.trajectory_len = 435

        # Initialize environment state
        self.state = np.zeros(self._get_env_state_len())
        rs_state = np.zeros(self._get_robot_server_state_len())
        
        # NOTE: maybe we can find a cleaner version when we have the final envs (we could prob remove it for the avoidance task altogether)
        # Set initial robot joint positions
        if initial_joint_positions:
            assert len(initial_joint_positions) == 6
            ur_initial_joint_positions = initial_joint_positions
        elif (len(self.last_position_on_success) != 0) and (type=='continue'):
            ur_initial_joint_positions = self.last_position_on_success
        else:
            ur_initial_joint_positions = self._get_initial_joint_positions()

        rs_state[6:12] = self.ur._ur_joint_list_to_ros_joint_list(ur_initial_joint_positions)


        # TODO: We should create some kind of helper function depending on how dynamic these settings should be
        # Set initial state of the Robot Server
        z_amplitude = np.random.default_rng().uniform(low=0.09, high=0.35)
        z_frequency = 0.125
        z_offset = np.random.default_rng().uniform(low=0.2, high=0.6)
        n_sampling_points = int(np.random.default_rng().uniform(low= 4000, high=50000))
        
        string_params = {"object_0_function": "3d_spline"}
        float_params = {"object_0_x_min": -0.7, "object_0_x_max": 0.7, "object_0_y_min": 0.2, "object_0_y_max": 1.0, \
                        "object_0_z_min": 0.1, "object_0_z_max": 1.0, "object_0_n_points": 10, \
                        "n_sampling_points": n_sampling_points}
        state_msg = robot_server_pb2.State(state = rs_state.tolist(), float_params = float_params, string_params = string_params)
        if not self.client.set_state_msg(state_msg):
            raise RobotServerError("set_state")

        # Get Robot Server state
        rs_state = copy.deepcopy(np.nan_to_num(np.array(self.client.get_state_msg().state)))
        self.prev_rs_state = copy.deepcopy(rs_state)

        # Check if the length of the Robot Server state received is correct
        if not len(rs_state)== self._get_robot_server_state_len():
            raise InvalidStateError("Robot Server state received has wrong length")

        # Convert the initial state from Robot Server format to environment format
        self.state = self._robot_server_state_to_env_state(rs_state)

        # save start position
        self.start_position = self.state[3:9]

        # Check if the environment state is contained in the observation space
        if not self.observation_space.contains(self.state):
            raise InvalidStateError()
        
        # check if current position is in the range of the initial joint positions
        if (len(self.last_position_on_success) == 0) or (type=='random'):
            joint_positions = self.ur._ros_joint_list_to_ur_joint_list(rs_state[6:12])
            tolerance = 0.1
            for joint in range(len(joint_positions)):
                if (joint_positions[joint]+tolerance < self.initial_joint_positions_low[joint]) or  (joint_positions[joint]-tolerance  > self.initial_joint_positions_high[joint]):
                    raise InvalidStateError('Reset joint positions are not within defined range')
            
        return self.state
    
    def step(self, action):
        self.elapsed_steps += 1

        # Check if the action is within the action space
        assert self.action_space.contains(action), "%r (%s) invalid" % (action, type(action))
        action = np.array(action)
        if self.last_action is None:
            self.last_action = action
        
        # Convert environment action to Robot Server action
        initial_joint_positions = self._get_trajectory_joint_positions()
        if action.size == 3:
            initial_joint_positions[1:4] = initial_joint_positions[1:4] + action
        elif action.size == 5:
            initial_joint_positions[0:5] = initial_joint_positions[0:5] + action
        elif action.size == 6:
            initial_joint_positions = initial_joint_positions + action

        rs_action = initial_joint_positions

        # Convert action indexing from ur to ros
        rs_action = self.ur._ur_joint_list_to_ros_joint_list(rs_action)
        # Send action to Robot Server
        if not self.client.send_action(rs_action.tolist()):
            raise RobotServerError("send_action")

        # Get state from Robot Server
        rs_state = self.client.get_state_msg().state
        self.prev_rs_state = copy.deepcopy(rs_state)

        # Convert the state from Robot Server format to environment format
        self.state = self._robot_server_state_to_env_state(rs_state)
        
        # Check if the environment state is contained in the observation space
        if not self.observation_space.contains(self.state):
            raise InvalidStateError()

        # Assign reward
        reward = 0
        done = False
        reward, done, info = self._reward(rs_state=rs_state, action=action)
        self.last_action = action

        return self.state, reward, done, info 

    def _get_trajectory_joint_positions(self):
        """Get trajectory robot joint positions.

        Returns:
            np.array: Joint positions with standard indexing.

        """
        
        joint_positions = np.array(TRAJECTORY[self.elapsed_steps % self.trajectory_len])

        return joint_positions
        
    def _set_initial_joint_positions_range(self):
        self.initial_joint_positions_low = - np.full((6), np.inf)
        self.initial_joint_positions_high = np.full((6), np.inf)
    
    def _get_initial_joint_positions(self):
        """Get initial robot joint positions.

        Returns:
            np.array: Joint positions with standard indexing.

        """
        
        # Fixed initial joint positions
        joint_positions = np.array(TRAJECTORY[0])

        return joint_positions
    
    def _robot_server_state_to_env_state(self, rs_state):
        """Transform state from Robot Server to environment format.

        Args:
            rs_state (list): State in Robot Server format.

        Returns:
            numpy.array: State in environment format.

        """
        # Convert to numpy array and remove NaN values
        rs_state = np.nan_to_num(np.array(rs_state))

        # Transform cartesian coordinates of target to polar coordinates 
        # with respect to the end effector frame
        target_coord = rs_state[0:3]
        
        ee_to_base_translation = rs_state[18:21]
        ee_to_base_quaternion = rs_state[21:25]
        ee_to_base_rotation = R.from_quat(ee_to_base_quaternion)
        base_to_ee_rotation = ee_to_base_rotation.inv()
        base_to_ee_quaternion = base_to_ee_rotation.as_quat()
        base_to_ee_translation = - ee_to_base_translation

        target_coord_ee_frame = utils.change_reference_frame(target_coord,base_to_ee_translation,base_to_ee_quaternion)
        target_polar = utils.cartesian_to_polar_3d(target_coord_ee_frame)

        # Transform joint positions and joint velocities from ROS indexing to
        # standard indexing
        ur_j_pos = self.ur._ros_joint_list_to_ur_joint_list(rs_state[6:12])
        ur_j_vel = self.ur._ros_joint_list_to_ur_joint_list(rs_state[12:18])

        # Normalize joint position values
        ur_j_pos_norm = self.ur.normalize_joint_values(joints=ur_j_pos)

        # start joint positions
        start_joints = self.ur.normalize_joint_values(self._get_trajectory_joint_positions())
        delta_joints = ur_j_pos_norm - start_joints

        # Compose environment state
        state = np.concatenate((target_polar, ur_j_pos_norm, delta_joints))

        return state

class FixedTraj1Box1PointsUR5DoF5(FixedTraj1Box1PointsUR5):
    def _get_action_space(self):
        return spaces.Box(low=np.full((5), -1.0), high=np.full((5), 1.0), dtype=np.float32)

class FixedTraj1Box1PointsUR5Sim(FixedTraj1Box1PointsUR5, Simulation):
    cmd = "roslaunch ur_robot_server ur5_sim_robot_server.launch \
        world_name:=box100.world \
        yaw:=-0.78\
        reference_frame:=world \
        max_velocity_scale_factor:=0.2 \
        action_cycle_rate:=20 \
        rviz_gui:=true \
        gazebo_gui:=true \
        objects_controller:=true \
        target_mode:=moving \
        n_objects:=1.0 \
        object_0_model_name:=box100 \
        object_0_frame:=target"
    def __init__(self, ip=None, lower_bound_port=None, upper_bound_port=None, gui=False, **kwargs):
        Simulation.__init__(self, self.cmd, ip, lower_bound_port, upper_bound_port, gui, **kwargs)
        FixedTraj1Box1PointsUR5.__init__(self, rs_address=self.robot_server_ip, **kwargs)

class FixedTraj1Box1PointsUR5Rob(FixedTraj1Box1PointsUR5):
    real_robot = True

# roslaunch ur_robot_server ur5_real_robot_server.launch gui:=true reference_frame:=base max_velocity_scale_factor:=0.2 action_cycle_rate:=20 target_mode:=1moving2points n_objects:=1.0 object_0_frame:=target

class FixedTraj1Box1PointsUR5DoF5Sim(FixedTraj1Box1PointsUR5DoF5, Simulation):
    cmd = "roslaunch ur_robot_server ur5_sim_robot_server.launch \
        world_name:=box100.world \
        yaw:=-0.78\
        reference_frame:=world \
        max_velocity_scale_factor:=0.2 \
        action_cycle_rate:=20 \
        rviz_gui:=true \
        gazebo_gui:=true \
        objects_controller:=true \
        target_mode:=moving \
        n_objects:=1.0 \
        object_0_model_name:=box100 \
        object_0_frame:=target"
    def __init__(self, ip=None, lower_bound_port=None, upper_bound_port=None, gui=False, **kwargs):
        Simulation.__init__(self, self.cmd, ip, lower_bound_port, upper_bound_port, gui, **kwargs)
        FixedTraj1Box1PointsUR5DoF5.__init__(self, rs_address=self.robot_server_ip, **kwargs)

class FixedTraj1Box1PointsUR5DoF5Rob(FixedTraj1Box1PointsUR5DoF5):
    real_robot = True

# roslaunch ur_robot_server ur5_real_robot_server.launch  gui:=true reference_frame:=base max_velocity_scale_factor:=0.2 action_cycle_rate:=20 target_mode:=1moving2points n_objects:=1.0 object_0_frame:=target

# maybe later
# roslaunch ur_robot_server ur5_sim_robot_server.launch camera1_gazebo:=true gui:=true camera1_link_y:=1 camera1_link_z:=1 camera1_link_pitch:=1.0 camera1_link_yaw:=-1.5 gazebo_gui:=True use_voxel_occupancy:=True 